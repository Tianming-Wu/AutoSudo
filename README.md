# AutoSudo - Windows 权限提升工具

一个类似 Linux `sudo` 的 Windows 权限提升工具，允许在用户会话中以不同权限级别运行应用程序。

## 功能特性

- 🚀 **多权限级别支持**：用户权限、管理员权限、SYSTEM 权限
- 🔐 **允许列表机制**：基于 SHA256 哈希的可执行文件认证
- 💬 **交互式确认**：首次运行或权限提升时请求用户确认
- 🛡️ **会话隔离**：在用户桌面会话中正确显示 GUI 应用程序
- 📝 **完整日志**：详细的运行日志和审计跟踪

## 权限级别

| 级别 | 描述 | 使用示例 |
|------|------|----------|
| `--user` | 当前用户权限 | `autosudo --user notepad` |
| `--admin` | 管理员权限（默认） | `autosudo --admin cmd` |
| `--system` | SYSTEM 权限 | `autosudo --system powershell` |

## 安装和使用

### 安装服务
```bash
autosudo --install
```

### 执行命令
```bash
# 默认管理员权限
autosudo notepad.exe
autosudo "C:\Program Files\MyApp\app.exe"

# 指定权限级别
autosudo --user notepad.exe
autosudo --admin cmd.exe
autosudo --system powershell.exe
```

### 服务管理
```bash
autosudo --start      # 启动服务
autosudo --stop       # 停止服务  
autosudo --status     # 检查状态（暂未支持）
autosudo --uninstall  # 卸载服务
```

## 工作原理

1. **客户端**解析命令行参数并构建进程上下文
2. 通过**命名管道**将请求发送到服务端
3. **服务端**检查允许列表和权限级别
4. 需要时显示**用户确认对话框**
5. 使用相应权限令牌**创建目标进程**

## 构建要求

- CMake 3.10+ （推荐 3.18+）
- C++23 兼容编译器（推荐使用 MSVC 2022 版本，因为这个项目是在这个版本上开发的）
- Windows SDK （10.0.19041.0 或更高版本）
- [SharedCppLib2 库](https://github.com/Tianming-Wu/SharedCppLib2) 兼容版本（一般保持最新即可，会同步更新）

## 构建步骤

```bash
mkdir build && cd build
cmake ..
cmake --build . --config Release
```

## 安全机制

- SHA256 文件完整性验证
- 命名管道通信（无法从外部直接访问）
- 基于令牌的权限控制
- 用户交互确认

> [!WARNING]
> **安全警告**
> 
> 此项目的安全措施目前还不完备，**仅作为实验和教育用途**，不建议在生产环境中使用。
> 
> **已知安全问题**：
> - 管道通信缺乏加密
> - 允许列表文件未加密存储
> - 没有防止重放攻击的机制
> - 没有对可执行文件的参数校验规则
> 
> 使用前请评估安全风险，并自行承担遭受攻击的风险。

## 开发状态

🚧 **实验阶段** - 核心功能基本完成，但需要进一步的安全加固和测试。

## 开发计划

- [x] 基本功能实现
- [x] 多权限级别支持
- [x] 允许列表机制
- [x] 用户交互确认
- [ ] 加密管道通信
- [ ] 添加参数安全控制规则
- [ ] 加密配置文件
- [ ] 加密凭据使用系统密钥存储（最大的后果只是丢失允许列表）
- [ ] 完善日志和审计功能
- [ ] 允许自定义 session ID（支持在其他激活用户会话中运行）
- [ ] 自动审计规则
- [ ] 防止重放攻击
- [ ] 支持对信任的数字签名可执行文件自动审计
- [ ] GUI 管理工具

## 许可证

此软件是自由软件，但作者没有义务保证其适用性或安全性。
你可以自由地修改，复制，分发此软件的源代码或二进制文件，但必须随附作者信息和项目源地址。
你可以将此软件或修改后的此软件用于商业用途，无需授权。
你可以附加自己的作者信息，但不得删除原有的作者信息。你可以自行附加条款，但是不得与上述条款冲突。
你可以在自己的项目中参考此软件的部分源代码，此种情况下不需要附带作者信息和项目源地址，但不得声称此部分代码是你原创的。
你不可以将此软件用于恶意用途，包括但不限于攻击他人计算机系统，散布恶意软件等。
你不可以发布修改后的此软件作为闭源软件。

## 贡献

欢迎提交 Issue 和 Pull Request 来帮助改进这个项目。